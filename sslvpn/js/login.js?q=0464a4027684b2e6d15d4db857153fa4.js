var my_xmlhttp=null,buf_request_in_progress=!1,token_push_request_in_progress=!1,famreqid="",pol_id="",grp="",pass_renew="",peer="",elm_ftm_push_enabled=document.getElementById("ftm_push_enabled"),ftm_pushed_enabled=elm_ftm_push_enabled&&elm_ftm_push_enabled.value;function get_xmlhttp(){var xmlhttp=null;try{xmlhttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(oc){xmlhttp=null}}return xmlhttp||"undefined"==typeof XMLHttpRequest||(xmlhttp=new XMLHttpRequest),xmlhttp}function handle_buffer_ready(){if(buf_request_in_progress){buf_request_in_progress=!1,token_push_request_in_progress=!1;var retval=my_xmlhttp.responseText;if(my_xmlhttp=null,0!=retval.length){for(var argv=retval.split(","),auth_ret=0,redir="",magic_val="",grpid="",pid="",chal_msg="",is_chal_rsp="",i=0;i<argv.length;i++)0==argv[i].indexOf("ret=")?auth_ret=parseInt(argv[i].substring(4)):0==argv[i].indexOf("redir=")?redir=argv[i].substring(6):0==argv[i].indexOf("err=")?argv[i].substring(4):0==argv[i].indexOf("reqid=")?famreqid=argv[i].substring(6):0==argv[i].indexOf("polid=")?pol_id=argv[i].substring(6):0==argv[i].indexOf("grp=")?grp=argv[i].substring(4):0==argv[i].indexOf("tokeninfo=")?tokeninfo=argv[i].substring(10):0==argv[i].indexOf("actionurl=")?argv[i].substring(10):0==argv[i].indexOf("magic=")?magic_val=argv[i].substring(6):0==argv[i].indexOf("grpid=")?grpid=argv[i].substring(6):0==argv[i].indexOf("pid=")?pid=argv[i].substring(4):0==argv[i].indexOf("is_chal_rsp=")?is_chal_rsp=argv[i].substring(12):0==argv[i].indexOf("pass_renew=")?pass_renew=argv[i].substring(11):0==argv[i].indexOf("allow_cancel=")?allow_cancel=parseInt(argv[i].substring(13)):0==argv[i].indexOf("chal_msg=")?(index=retval.indexOf("chal_msg="),index&&(chal_msg=retval.substring(index+9))):0==argv[i].indexOf("peer=")&&(peer=argv[i].substring(5));try{document.getElementById("token_msg").style.display="none"}catch(e){}if(0!=auth_ret){var elm_err_str=document.getElementById("err_str");elm_err_str&&(elm_err_str.style.display="none")}if(6!=auth_ret)try{document.getElementById("credential2").disabled=!0,document.getElementById("credential2").style.display="none",document.getElementById("credential3").style.display="none"}catch(e){}switch(auth_ret){case 0:case 1:return void(document.location=redir);case 2:document.getElementById("username").style.display="",document.getElementById("credential").style.display="",document.getElementById("username").disabled=!0,document.getElementById("credential").disabled=!0,document.getElementById("code").value="",document.getElementById("code").style.display="",document.getElementById("code").focus(),"ftm_push"==tokeninfo&&ftm_pushed_enabled&&!token_push_request_in_progress&&try_ftm_push(pol_id);break;case 3:document.getElementById("username").disabled=!0,document.getElementById("credential").disabled=!0,document.getElementById("token_msg").style.display="",document.getElementById("token_label").innerHTML="An email message containing a Token Code will be sent to &lt;"+decodeURIComponent(tokeninfo)+"&gt; in a moment.",document.getElementById("code").placeholder="Email Code",document.getElementById("code").value="",document.getElementById("code").style.display="",document.getElementById("code").focus();break;case 4:document.getElementById("username").disabled=!0,document.getElementById("credential").disabled=!0,document.getElementById("token_msg").style.display="",document.getElementById("token_label").innerHTML="An SMS message containing a Token Code will be sent to &lt;"+decodeURIComponent(tokeninfo)+"&gt; in a moment.",document.getElementById("code").placeholder="SMS Code",document.getElementById("code").value="",document.getElementById("code").style.display="",document.getElementById("code").focus();break;case 5:document.getElementById("code").disabled=!0,document.getElementById("driftmsg").style.display="",document.getElementById("code2").value="",document.getElementById("code2").style.display="",document.getElementById("code2").focus();break;case 6:document.getElementById("username").style.display="none",document.getElementById("credential").style.display="none",document.getElementById("code").style.display="none",document.getElementById("credential2").disabled=!1,document.getElementById("credential2").value="",document.getElementById("credential3").value="",document.getElementById("token_msg").style.display="",document.getElementById("token_label").innerHTML=chal_msg,"1"==pass_renew?(document.getElementById("credential2").placeholder="New Password",document.getElementById("credential3").placeholder="Confirm New Password",document.getElementById("credential3").style.display="",1==allow_cancel&&(document.getElementById("skip_button").style.display="block")):(document.getElementById("credential2").placeholder="Answer",document.getElementById("credential3").style.display="none"),document.getElementById("credential2").style.display=""}magic_val&&(document.getElementById("magic_id").disabled=!1,document.getElementById("reqid_id").disabled=!1,document.getElementById("grpid_id").disabled=!1,document.getElementById("magic_id").value=magic_val,document.getElementById("reqid_id").value=famreqid+","+pol_id,document.getElementById("grpid_id").value=grpid+","+pid+","+is_chal_rsp)}}}function login_send_request(str_url,str_body){(my_xmlhttp=get_xmlhttp()).onreadystatechange=handle_buffer_statechange,my_xmlhttp.open("POST.html",str_url,!0),my_xmlhttp.setRequestHeader("Pragma","no-cache"),my_xmlhttp.setRequestHeader("Cache-Control","no-store, no-cache, must-revalidate"),my_xmlhttp.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),my_xmlhttp.send(str_body),document.getElementById("magic_id").value=""}function handle_buffer_statechange(ev){4==my_xmlhttp.readyState&&handle_buffer_ready()}function try_login(){if(buf_request_in_progress&&!token_push_request_in_progress)throw"Avoid sending conflicting request\n";token_push_request_in_progress&&abort_current_request(),buf_request_in_progress=!0;var elm_username=document.getElementById("username"),elm_realm=document.getElementById("realm_id"),xstr="ajax=1&username="+encodeURIComponent(elm_username.value),elm_credential=document.getElementById("credential"),elm_credential2=null;xstr+="&realm="+encodeURIComponent(elm_realm.value);var chal=document.getElementById("magic_id");if("none"==document.getElementById("code").style.display){if(chal&&""!=chal.value)if("1"==pass_renew){elm_credential=document.getElementById("credential2");var elm_credential_confirm=document.getElementById("credential3");if(elm_credential.value!=elm_credential_confirm.value)return buf_request_in_progress=!1,void alert("The passwords do not match!")}else elm_credential2=document.getElementById("credential2")}else xstr+="&code="+document.getElementById("code").value+"&code2="+document.getElementById("code2").value+"&polid="+pol_id+"&grp="+grp;chal&&""!=chal.value&&(xstr+="&magic="+chal.value+"&reqid="+document.getElementById("reqid_id").value+"&grpid="+document.getElementById("grpid_id").value),peer&&(xstr+="&peer="+peer),xstr+="&credential="+encodeURIComponent(elm_credential.value),elm_credential2&&(xstr+="&credential2="+encodeURIComponent(elm_credential2.value));try{login_send_request("/remote/logincheck",xstr)}catch(e){buf_request_in_progress=!1,token_push_request_in_progress=!1,abort_current_request()}}function try_skip(){if(buf_request_in_progress&&!token_push_request_in_progress)throw"Avoid sending conflicting request\n";token_push_request_in_progress&&abort_current_request(),buf_request_in_progress=!0;var elm_username=document.getElementById("username"),elm_realm=document.getElementById("realm_id"),xstr="ajax=1&username="+encodeURIComponent(elm_username.value),elm_credential=document.getElementById("credential");xstr+="&magic="+document.getElementById("magic_id").value,xstr+="&realm="+encodeURIComponent(elm_realm.value),xstr+="&credential="+encodeURIComponent(elm_credential.value),xstr+="&reqid="+famreqid,xstr+="&grpid="+document.getElementById("grpid_id").value,xstr+="&skip=1",peer&&(xstr+="&peer="+peer);try{login_send_request("/remote/logincheck",xstr)}catch(e){token_push_request_in_progress=!1,abort_current_request()}}function try_ftm_push(fac_id){if(buf_request_in_progress)throw"Avoid sending conflicting request\n";buf_request_in_progress=!0,token_push_request_in_progress=!0;var elm_username=document.getElementById("username"),elm_realm=document.getElementById("realm_id"),xstr="ajax=1&username="+encodeURIComponent(elm_username.value),elm_credential=document.getElementById("credential"),elm_magic=document.getElementById("magic_id");xstr+="&realm="+encodeURIComponent(elm_realm.value),xstr+="&credential="+encodeURIComponent(elm_credential.value),xstr+="&magic="+elm_magic.value,xstr+="&ftmpush=1",void 0!==fac_id&&(xstr+="&polid="+fac_id),xstr+="&reqid="+famreqid,xstr+="&grp="+grp,peer&&(xstr+="&peer="+peer);try{login_send_request("/remote/logincheck",xstr)}catch(e){token_push_request_in_progress=!1,abort_current_request()}}function login_get_cmd_kbd_event(evt_p){return evt_p||(evt=window.event,evt||null)}function login_crack_kbd_event(evt){return evt.which?evt.which:evt.keyCode?evt.keyCode:evt.charCode?evt.charCode:0}function key_pressdown(evt_p){try{var evt=login_get_cmd_kbd_event(evt_p);if(null==evt)return;var key_code=login_crack_kbd_event(evt);if(0==key_code)return;if(13==key_code)return document.getElementById("login_button").click(),!1}catch(e){}return!0}function abort_current_request(){my_xmlhttp.abort(),delete my_xmlhttp,my_xmlhttp=null}function launchFortiClient(){document.querySelector("#launch-forticlient-iframe").src="forticlient://?hostname="+encodeURIComponent(window.location.hostname)+"&"+(window.location.port?"port="+encodeURIComponent(window.location.port):"")}function launchSamlLogin(){var elm_realm=document.getElementById("realm_id");url="/remote/saml/start?realm="+encodeURIComponent(elm_realm.value),window.location=elm_realm?url:"/remote/saml/start"}document.addEventListener("DOMContentLoaded",function(){-1!==navigator.platform.indexOf("Linux")&&(document.querySelector("#launch-forticlient-button").style.display="none");var fortiClient_but=document.getElementById("launch-forticlient-button");fortiClient_but&&"Launch FortiClient"==fortiClient_but.lastElementChild.innerHTML.trim()&&(fortiClient_but.innerHTML=fgt_lang["sslvpn_portal::Launch FortiClient"]);var elm_saml_login=document.getElementById("saml_login_id");if(elm_saml_login&&"0"!=elm_saml_login.value){var e_saml_bn=document.getElementById("saml-login-bn");e_saml_bn&&(e_saml_bn.innerHTML=fgt_lang["sslvpn-saml_login"],e_saml_bn.style.display="")}var elm_login_bn=document.getElementById("login_button");elm_login_bn&&"Login"==elm_login_bn.innerHTML.trim()&&(elm_login_bn.innerHTML=fgt_lang.sslvpn_login_login_b),document.getElementById("username").placeholder=fgt_lang.Username,document.getElementById("credential").placeholder=fgt_lang.Password;var elm_login_title=document.getElementById("login-login");elm_login_title&&"Please Login"==elm_login_title.innerHTML.trim()&&(elm_login_title.innerHTML=fgt_lang.sslvpn_login_login)});